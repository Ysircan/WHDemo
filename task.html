<!DOCTYPE html>

<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>ä»»åŠ¡ç­”é¢˜ - Word Hunter</title>
  <style>
    body {
      background-color: #f0f4fa;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .topbar {
      padding: 20px;
      background-color: #007bff;
      color: white;
      font-size: 18px;
    }
    .outer-box {
      background-color: #e2e8f0;
      padding: 40px 20px;
      border-radius: 12px;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
      width: 90%;
      max-width: 500px;
      margin: 40px auto;
    }
    .task-box {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .header-strip {
      background-color: #007bff;
      color: white;
      font-size: 20px;
      padding: 12px;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }
    .task-title {
      font-size: 22px;
      margin: 30px 0;
      line-height: 1.6;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.5s forwards;
    }
    .option-btn {
      display: block;
      width: 80%;
      margin: 10px auto;
      padding: 12px;
      font-size: 16px;
      background-color: #ffffff;
      color: #333;
      border: 2px solid #007bff;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.5s forwards;
    }
    .option-btn:hover {
      background-color: #007bff;
      color: white;
    }
    .feedback {
      margin-top: 20px;
      font-weight: bold;
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
       .navbar {
  background-color: #007bff;
  width: 100vw;
  padding: 14px 40px;
  box-sizing: border-box;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 0;
}

.nav-left {
  display: flex;
  gap: 30px;
  align-items: center;
}

.nav-link {
  color: #ffffff;
  text-decoration: none;
  font-weight: bold;
  font-size: 16px;
  transition: color 0.2s;
}

.nav-link:hover {
  color: #ffd700;
}
    #questionNav button:hover {
  background-color: #d0e6ff !important;
  border-color: #007bff !important;
}

  </style>
</head>
<body>
<div class="navbar">
  <div class="nav-left">
    <a href="draw.html" class="nav-link">ğŸƒ æŠ½å¡</a>
    <a href="gallery.html" class="nav-link">ğŸ–¼ å›¾é‰´</a>
    <a href="audio.html" class="nav-link">ğŸ§ å¬åŠ›ç»ƒä¹ </a>
    <a href="wrong.html" class="nav-link">ğŸ“˜ é”™é¢˜æœ¬</a>
    <a href="home.html" class="nav-link">ğŸ  ä¸»é¡µ</a>
  </div>
</div>


  <div class="outer-box">
      <div class="topbar" id="topbar">åŠ è½½ä¸­...</div>
    <div class="task-box">
      <div class="header-strip">ä»»åŠ¡ç­”é¢˜</div>
      <div class="task-title" id="taskText">é¢˜ç›®åŠ è½½ä¸­...</div>
      <div id="optionsContainer"></div>
      <div class="feedback" id="feedbackText"></div>
    </div>
    <!-- âœ… å¯¼èˆªæ  -->
  <div id="questionNav" style="width: 200px;"></div>

  </div>

  <script>
    const tasks = [

  {
    type: "word",
    word: "architecture",
    answer: "å»ºç­‘å­¦",
    options: ["å»ºç­‘å­¦", "å·¥ç¨‹", "ç»˜ç”»", "å†œä¸š"]
  },
  {
    type: "word",
    word: "urbanization",
    answer: "åŸå¸‚åŒ–",
    options: ["åŸå¸‚åŒ–", "å†œæ‘åŒ–", "å·¥ä¸šåŒ–", "æ¤è¢«æ¢å¤"]
  },
  {
    type: "word",
    word: "provide",
    answer: "æä¾›",
    options: ["æä¾›", "éœ€è¦", "è´­ä¹°", "ä¿®å¤"]
  },
  {
    type: "word",
    word: "expense",
    answer: "èŠ±è´¹",
    options: ["èŠ±è´¹", "æ”¶å…¥", "åˆ©æ¶¦", "æ‰“æŠ˜"]
  },
  {
    type: "word",
    word: "management",
    answer: "ç®¡ç†",
    options: ["ç®¡ç†", "è´¢åŠ¡", "æŠ€æœ¯", "å®¢æˆ·"]
  },
  {
    type: "word",
    word: "tricky",
    answer: "æ£˜æ‰‹çš„",
    options: ["æ£˜æ‰‹çš„", "ç®€å•çš„", "æ„‰å¿«çš„", "æ¯ç‡¥çš„"]
  },
  {
    type: "word",
    word: "pollution",
    answer: "æ±¡æŸ“",
    options: ["æ±¡æŸ“", "å‡€åŒ–", "èµ„æº", "æ°§æ°”"]
  },
  {
    type: "word",
    word: "serious",
    answer: "ä¸¥é‡çš„",
    options: ["ä¸¥é‡çš„", "æç¬‘çš„", "è½»æ¾çš„", "å¹³å¸¸çš„"]
  },
  {
    type: "word",
    word: "course",
    answer: "è¯¾ç¨‹",
    options: ["è¯¾ç¨‹", "æ•™å®¤", "è€ƒè¯•", "å­¦æœŸ"]
  },
  {
    type: "word",
    word: "seminar",
    answer: "ç ”è®¨ä¼š",
    options: ["ç ”è®¨ä¼š", "å®éªŒå®¤", "è®²åº§", "å±•è§ˆ"]
  },
  {
    type: "word",
    word: "scholarship",
    answer: "å¥–å­¦é‡‘",
    options: ["å¥–å­¦é‡‘", "å·¥èµ„", "å­¦è´¹", "è´·æ¬¾"]
  },
  {
    type: "word",
    word: "application",
    answer: "ç”³è¯·",
    options: ["ç”³è¯·", "æ‹’ç»", "è®¡åˆ’", "æ€»ç»“"]
  },
  {
    type: "word",
    word: "shelf",
    answer: "æ¶å­",
    options: ["æ¶å­", "æ©±æŸœ", "åœ°æ¿", "å¤©èŠ±æ¿"]
  },
  {
    type: "word",
    word: "reference",
    answer: "å‚è€ƒ",
    options: ["å‚è€ƒ", "ä¼šè®®", "æŠ¥å‘Š", "ææ¡ˆ"]
  },
  {
    type: "word",
    word: "workshop",
    answer: "å·¥ä½œåŠ",
    options: ["å·¥ä½œåŠ", "åŠå…¬å®¤", "å·¥å‚", "å±•è§ˆ"]
  },
  {
    type: "word",
    word: "campus",
    answer: "æ ¡å›­",
    options: ["æ ¡å›­", "å›¾ä¹¦é¦†", "æ•™å ‚", "è¶…å¸‚"]
  },
  {
    type: "word",
    word: "deadline",
    answer: "æˆªæ­¢æ—¥æœŸ",
    options: ["æˆªæ­¢æ—¥æœŸ", "è€ƒè¯•", "é€šçŸ¥", "å¯åŠ¨æ—¶é—´"]
  },
  {
    type: "word",
    word: "complete",
    answer: "å®Œæˆ",
    options: ["å®Œæˆ", "å¼€å§‹", "å–æ¶ˆ", "å»¶è¿Ÿ"]
  },
  {
    type: "word",
    word: "direct",
    answer: "æŒ‡å¯¼",
    options: ["æŒ‡å¯¼", "å¿½ç•¥", "é˜»æ­¢", "è½¬ç§»"]
  },
  {
    type: "word",
    word: "essential",
    answer: "å¿…è¦çš„",
    options: ["å¿…è¦çš„", "æ— èŠçš„", "å¥¢ä¾ˆçš„", "å¶ç„¶çš„"]
  },
  {
    type: "word",
    word: "assistant",
    answer: "åŠ©ç†",
    options: ["åŠ©ç†", "ç»ç†", "å®¢æˆ·", "æ•™å¸ˆ"]
  },
  {
    type: "word",
    word: "styles",
    answer: "é£æ ¼",
    options: ["é£æ ¼", "è¯­è¨€", "ä»»åŠ¡", "ä½œä¸š"]
  },
  {
    type: "word",
    word: "subject",
    answer: "ç§‘ç›®",
    options: ["ç§‘ç›®", "å¯¹è±¡", "ç‰©å“", "å†…å®¹"]
  },
  {
    type: "word",
    word: "invented",
    answer: "å‘æ˜",
    options: ["å‘æ˜", "å‘ç°", "å‡ºå”®", "æ¨¡ä»¿"]
  },
  {
    type: "word",
    word: "teenager",
    answer: "é’å°‘å¹´",
    options: ["é’å°‘å¹´", "å„¿ç«¥", "å©´å„¿", "æˆäºº"]
  },
  {
    type: "word",
    word: "allow",
    answer: "å…è®¸",
    options: ["å…è®¸", "å¼ºè¿«", "åå¯¹", "ç¦æ­¢"]
  },
  {
    type: "word",
    word: "cloth",
    answer: "å¸ƒæ–™",
    options: ["å¸ƒæ–™", "æœè£…", "çººç»‡å‚", "åœ°æ¯¯"]
  },
  {
    type: "word",
    word: "accident",
    answer: "äº‹æ•…",
    options: ["äº‹æ•…", "è®¡åˆ’", "å®‰æ’", "å»ºè®®"]
  },
  {
    type: "word",
    word: "discover",
    answer: "å‘ç°",
    options: ["å‘ç°", "å‘æ˜", "å‘å±•", "åˆ†å‘"]
  },
  {
    type: "word",
    word: "achieve",
    answer: "å®ç°",
    options: ["å®ç°", "æè¿°", "è®¨è®º", "å°è¯•"]
  }
,
  {
    type: "listening",
    audio: "audio/051.mp3",
    sentence: "Scholarships are available for both ___ and ___ students.",
    blanks: ["local", "international"]
  },
  {
    type: "listening",
    audio: "audio/052.mp3",
    sentence: "All students have their own ___ of ___.",
    blanks: ["style", "learning"]
  },
  {
    type: "listening",
    audio: "audio/053.mp3",
    sentence: "We help ___ to develop and follow their ___.",
    blanks: ["individuals", "interests"]
  },
  {
    type: "listening",
    audio: "audio/054.mp3",
    sentence: "Our company currently ___ more than ten thousand people ___.",
    blanks: ["employs", "worldwide"]
  },
  {
    type: "listening",
    audio: "audio/055.mp3",
    sentence: "It is clear that the human ___ has an impact on the ___.",
    blanks: ["population", "environment"]
  },
  {
    type: "listening",
    audio: "audio/056.mp3",
    sentence: "Every ___ thing begins as a single ___.",
    blanks: ["living", "cell"]
  },
  {
    type: "listening",
    audio: "audio/057.mp3",
    sentence: "Technology is no longer a ___ tool that we can ___.",
    blanks: ["simple", "control"]
  },
  {
    type: "listening",
    audio: "audio/058.mp3",
    sentence: "British students must study ___ at secondary ___.",
    blanks: ["mathematics", "schools"]
  },
  {
    type: "listening",
    audio: "audio/059.mp3",
    sentence: "You need to ___ in an essay next ___.",
    blanks: ["hand", "semester"]
  },
  {
    type: "listening",
    audio: "audio/060.mp3",
    sentence: "Please click on the ___ above to enter the ___.",
    blanks: ["logo", "site"]
  },
  {
    type: "listening",
    audio: "audio/061.mp3",
    sentence: "If you need a parking ___, see me after the ___.",
    blanks: ["ticket", "lecture"]
  },
  {
    type: "listening",
    audio: "audio/062.mp3",
    sentence: "Advanced ___ created growth in the ___.",
    blanks: ["technology", "economy"]
  },
  {
    type: "listening",
    audio: "audio/063.mp3",
    sentence: "Optional ___ are offered in the final week of the ___.",
    blanks: ["tutorials", "term"]
  },
  {
    type: "listening",
    audio: "audio/064.mp3",
    sentence: "The aim of the course is to encourage students to develop their ___.",
    blanks: ["creativity"]
  },
  {
    type: "listening",
    audio: "audio/065.mp3",
    sentence: "___ have founded all parts of society today.",
    blanks: ["Scientists"]
  },
  {
    type: "listening",
    audio: "audio/066.mp3",
    sentence: "Practical ___ is a vital part of legal ___.",
    blanks: ["experience", "training"]
  },
  {
    type: "listening",
    audio: "audio/067.mp3",
    sentence: "There is a ___ on campus near the ___.",
    blanks: ["pharmacy", "bookstore"]
  },
  {
    type: "listening",
    audio: "audio/068.mp3",
    sentence: "The lecture will take place in the ___ ___.",
    blanks: ["main", "hall"]
  },
  {
    type: "listening",
    audio: "audio/069.mp3",
    sentence: "A wide range of ___ covered different ___ in this subject.",
    blanks: ["courses", "aspects"]
  },
  {
    type: "listening",
    audio: "audio/070.mp3",
    sentence: "In his lifetime, he ___ a large number of ___.",
    blanks: ["composed", "works"]
  }
];


    let currentIndex = parseInt(localStorage.getItem("taskIndex")) || 0;
    let nickname = localStorage.getItem("userNickname") || "æœªå‘½åç”¨æˆ·";
    const todayKey = new Date().toDateString();
let isLocked = localStorage.getItem("taskCompleted_" + todayKey) === "true";


function recordWrong(item) {
  const today = new Date().toISOString().split("T")[0]; // e.g. "2025-05-16"
  const lockKey = "taskCompleted_" + today;
  const isLocked = localStorage.getItem(lockKey) === "true";

  if (isLocked) {
    console.log("ä»Šæ—¥ä»»åŠ¡å·²å®Œæˆï¼Œä¸è®°å½•é”™é¢˜");
    return;
  }

  const data = JSON.parse(localStorage.getItem("wrongRecords") || "{}");

  if (!data[today]) data[today] = [];

  data[today].push(item);

  localStorage.setItem("wrongRecords", JSON.stringify(data));
}

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

  function submitAnswer(selected) {
  const correct = tasks[currentIndex].answer;
  let points = parseInt(localStorage.getItem("points")) || 0;

  if (!isLocked) {
    if (selected === correct) {
      points += 1;
      localStorage.setItem("points", points);
      document.getElementById("feedbackText").innerText = "âœ… æ­£ç¡®ï¼ +1ç§¯åˆ†";
      localStorage.setItem("taskResult_" + currentIndex, "correct"); 
      updateProgressRecord();

       // âœ… æ­£ç¡®è®°å½•
       
    } else {
      document.getElementById("feedbackText").innerText = "âŒ é”™è¯¯";
      localStorage.setItem("taskResult_" + currentIndex, "wrong");    // âœ… åªé”™æ—¶è®°å½• wrong
      updateProgressRecord();

      recordWrong({
  type: "word",
  question: tasks[currentIndex].word,
  correct: correct,
  userAnswer: selected
});

    }

    if (currentIndex + 1 >= tasks.length) {
    localStorage.setItem("taskCompleted_" + todayKey, "true");
isLocked = true;

    }

  } else {
    if (selected === correct) {
      document.getElementById("feedbackText").innerText = "âœ… æ­£ç¡®ï¼ˆç§¯åˆ†å·²é”å®šï¼‰";
      localStorage.setItem("taskResult_" + currentIndex, "correct");
    } else {
      document.getElementById("feedbackText").innerText = "âŒ é”™è¯¯ï¼ˆç§¯åˆ†å·²é”å®šï¼‰";
      localStorage.setItem("taskResult_" + currentIndex, "wrong");
    }
  }

  currentIndex++;
  localStorage.setItem("taskIndex", currentIndex);

  setTimeout(() => {
    loadTask();
    updateTopBar();
    setTimeout(() => {
  loadTask();
  updateTopBar();
  renderQuestionNav(); // âœ… æ·»åŠ è¿™ä¸€è¡Œ
}, 800);

  }, 800);
}

    renderQuestionNav();

    function loadTask() {
  if (currentIndex >= tasks.length) {
    document.querySelector(".task-box").innerHTML = `
      <div class="header-strip">âœ… æ­å–œå®Œæˆç¬¬äºŒé˜¶æ®µ</div>
      <div class="task-title">
        ğŸ“¸ è¯·è”ç³»è€å¸ˆå®Œæˆç…§ç‰‡æ‰“å¡ä»»åŠ¡ï¼Œ<br>
        æˆåŠŸåå°†è·å¾—<span style="color:#f39c12;"> +10ç§¯åˆ†</span>ï¼Œå¹¶è§£é”ğŸ ç¬¬ä¸‰æ¬¡æŠ½å¡æœºä¼šï¼
        <br><br>
        <button class="option-btn" onclick="restartTask()">ğŸ” å†ç­”ä¸€æ¬¡</button>
      </div>
    `;
    return;
  }

  const task = tasks[currentIndex];
  document.getElementById("feedbackText").innerText = "";

  if (task.type === "word") {
    document.getElementById("taskText").innerText = `ã€ç¬¬ ${currentIndex + 1} é¢˜ã€‘"${task.word}" çš„ä¸­æ–‡æ„æ€æ˜¯ï¼Ÿ`;
    const optionsHTML = shuffle([...task.options]).map(opt =>
      `<button class="option-btn" onclick="submitAnswer('${opt}')">${opt}</button>`
    ).join("");
    document.getElementById("optionsContainer").innerHTML = optionsHTML;

  } else if (task.type === "listening") {
    document.getElementById("taskText").innerHTML = `
      ã€ç¬¬ ${currentIndex + 1} é¢˜ã€‘è¯·å¬éŸ³é¢‘å¹¶å¡«å†™å¥å­ä¸­çš„ç©ºï¼š
      <br><br><audio controls src="${task.audio}"></audio><br><br>
    `;

    let parts = task.sentence.split("___");
    let html = "";
    for (let i = 0; i < parts.length; i++) {
      html += parts[i];
      if (i < task.blanks.length) {
        html += `<input type="text" class="input-blank" style="width: 80px; padding: 6px; font-size: 16px; margin: 0 4px;">`;
      }
    }
    html += `<br><br><button class="option-btn" onclick="submitListening()">æäº¤</button>`;

    document.getElementById("optionsContainer").innerHTML = html;
  }
}
renderQuestionNav();


    function updateTopBar() {
      const points = parseInt(localStorage.getItem("points")) || 0;
      document.getElementById("topbar").innerText = `ä½ å¥½ï¼Œ${nickname} ï½œ å½“å‰ç§¯åˆ†ï¼š${points}`;
    }

    function restartTask() {
      localStorage.removeItem("taskIndex");
      location.reload();
    }

    document.addEventListener("DOMContentLoaded", function () {
      updateTopBar();
      loadTask();
    });
    let hasSubmitted = false; // å…¨å±€çŠ¶æ€ï¼šæ˜¯å¦å·²æäº¤ç­”æ¡ˆ

function submitListening() {
  const inputs = document.querySelectorAll(".input-blank");
  const task = tasks[currentIndex];
  const feedback = document.getElementById("feedbackText");
  const button = document.querySelector(".option-btn");

  if (!hasSubmitted) {
    // ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼šæ‰§è¡Œåˆ¤é¢˜é€»è¾‘
    let correct = true;
    let points = parseInt(localStorage.getItem("points")) || 0;

    inputs.forEach((input, index) => {
      const userAnswer = input.value.trim().toLowerCase();
      const expected = task.blanks[index].toLowerCase();

      // æ¸…é™¤æ—§æ ‡è®°
      const oldMark = input.nextElementSibling;
      if (oldMark && oldMark.classList.contains("result-icon")) oldMark.remove();

      // æ·»åŠ æ–°æ ‡è®°
      const mark = document.createElement("span");
      mark.classList.add("result-icon");
      mark.style.marginLeft = "6px";
      mark.style.fontWeight = "bold";

      if (userAnswer === expected) {
        mark.innerText = "âœ”";
        mark.style.color = "green";
      } else {
        mark.innerText = "âœ˜";
        mark.style.color = "red";
        correct = false;
      }

      input.after(mark);
      input.disabled = true;
    });

    // ç§¯åˆ†é€»è¾‘
    if (!isLocked) {
      if (correct) {
        points += 1;
        localStorage.setItem("points", points);
        feedback.innerText = "âœ… å…¨éƒ¨æ­£ç¡®ï¼+1ç§¯åˆ†";
        updateProgressRecord();


      } else {
        feedback.innerText = "âŒ æœ‰é”™è¯¯ï¼ŒæœªåŠ åˆ†";
        localStorage.setItem("taskResult_" + currentIndex, "wrong");
        updateProgressRecord();

        recordWrong({
  type: "listening",
  sentence: task.sentence,
  correctBlanks: task.blanks,
  userAnswers: Array.from(inputs).map(i => i.value.trim())
});


      }

  if (currentIndex + 1 >= tasks.length) {
  const todayKey = new Date().toDateString();
  localStorage.setItem("taskCompleted_" + todayKey, "true");
  isLocked = true;
}

    } else {
      feedback.innerText = correct ? "âœ… æ­£ç¡®ï¼ˆç§¯åˆ†å·²é”å®šï¼‰" : "âŒ é”™è¯¯ï¼ˆç§¯åˆ†å·²é”å®šï¼‰";
    }

    // ä¿®æ”¹æŒ‰é’®ä¸ºâ€œä¸‹ä¸€é¢˜â€
    button.innerText = "â¡ï¸ ä¸‹ä¸€é¢˜";
    hasSubmitted = true;

  } else {
    // ç¬¬äºŒæ¬¡ç‚¹å‡»ï¼šè¿›å…¥ä¸‹ä¸€é¢˜
    hasSubmitted = false;
    currentIndex++;
    localStorage.setItem("taskIndex", currentIndex);
    loadTask();
    updateTopBar();
renderQuestionNav(); // âœ… æ·»åŠ è¿™ä¸€è¡Œ

  }
}
renderQuestionNav();

function renderQuestionNav() {
  const nav = document.getElementById("questionNav");
  let html = "<div style='font-weight: bold; margin-bottom: 12px;'>é¢˜ç›®è·³è½¬</div><div style='display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;'>";

for (let i = 0; i < tasks.length; i++) {
  const isCurrent = i === currentIndex;
  const result = localStorage.getItem("taskResult_" + i);

  let borderColor, bgColor, textColor;

  if (isCurrent) {
    // å½“å‰é¢˜ç›®ä¼˜å…ˆçº§æœ€é«˜
    borderColor = '#007bff';
    bgColor = '#e6f0ff';
    textColor = '#007bff';
  } else if (result === "correct") {
    // æ­£ç¡®ï¼šç»¿è‰²
    borderColor = '#28a745';
    bgColor = '#e6f9ec';
    textColor = '#28a745';
  } else if (result === "wrong") {
    // é”™è¯¯ï¼šçº¢è‰²
    borderColor = '#dc3545';
    bgColor = '#fdecea';
    textColor = '#dc3545';
  } else {
    // æœªåšé¢˜
    borderColor = '#ccc';
    bgColor = '#f2f2f2';
    textColor = '#333';
  }

  html += `<button 
    onclick="jumpTo(${i})"
    style="
      width: 34px;
      height: 34px;
      font-size: 14px;
      font-weight: bold;
      border-radius: 6px;
      border: 2px solid ${borderColor};
      background-color: ${bgColor};
      color: ${textColor};
      cursor: pointer;
    "
  >${i + 1}</button>`;
}

  html += "</div>";
  nav.innerHTML = html;
}





function jumpTo(index) {
  currentIndex = index;
  localStorage.setItem("taskIndex", currentIndex);
  hasSubmitted = false;
  loadTask();
 renderQuestionNav();

  updateTopBar();
}
function updateProgressRecord() {
  let count = 0;
  for (let i = 0; i < tasks.length; i++) {
    const result = localStorage.getItem("taskResult_" + i);
    if (result) count++;
  }
  localStorage.setItem("taskProgress", count);
}


  </script>

</body>
</html>   
